<script>
// POSIÇÕES DAS CASAS (geradas pelo picker)
const SPACES = [
  /* JSON DO PICKER AQUI */
];

const zoomWrap = document.getElementById('zoomWrap');
const boardFrame = document.getElementById('boardFrame');

const pawns = [
  document.getElementById('pawn0'),
  document.getElementById('pawn1'),
  document.getElementById('pawn2'),
  document.getElementById('pawn3'),
];

const selectPawn = document.getElementById('selectPawn');
const rollBtn = document.getElementById('rollBtn');
const diceVal = document.getElementById('diceVal');

let selectedPawnIndex = 0;
let pawnPosIndex = [0,0,0,0];

function placePawn(pawnEl, posIndex){
  const s = SPACES[posIndex];
  if(!s) return;
  pawnEl.style.left = (s.x * boardFrame.clientWidth) + 'px';
  pawnEl.style.top  = (s.y * boardFrame.clientHeight) + 'px';
}

function zoomTo(px, py, scale=1.6){
  const frameRect = boardFrame.getBoundingClientRect();
  const centerX = frameRect.width / 2;
  const centerY = frameRect.height / 2;
  const tx = (centerX - px) * (scale - 1);
  const ty = (centerY - py) * (scale - 1);
  zoomWrap.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
}

async function movePawnAnimated(pawnIndex, steps){
  let current = pawnPosIndex[pawnIndex];
  for(let i=0;i<steps;i++){
    current = Math.min(SPACES.length - 1, current + 1);
    pawnPosIndex[pawnIndex] = current;
    placePawn(pawns[pawnIndex], current);
    const s = SPACES[current];
    zoomTo(
      s.x * boardFrame.clientWidth,
      s.y * boardFrame.clientHeight,
      1.6
    );
    await new Promise(r => setTimeout(r, 280));
  }
  const s = SPACES[pawnPosIndex[pawnIndex]];
  zoomTo(
    s.x * boardFrame.clientWidth,
    s.y * boardFrame.clientHeight,
    1.15
  );
}

function setSelectedPawn(i){
  selectedPawnIndex = i;
  pawns.forEach((p,idx)=>p.classList.toggle('selected', idx===i));
}

rollBtn.addEventListener('click', async ()=>{
  rollBtn.disabled = true;
  const r = Math.floor(Math.random()*6)+1;
  diceVal.textContent = r;
  await movePawnAnimated(selectedPawnIndex, r);
  rollBtn.disabled = false;
});

selectPawn.addEventListener('change', e=>setSelectedPawn(Number(e.target.value)));

function init(){
  pawns.forEach((p,i)=>{
    placePawn(p,0);
    p.addEventListener('click', ()=>setSelectedPawn(i));
  });
  setSelectedPawn(0);
}

init();
</script>
