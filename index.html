<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</title>

<style>
:root{
  --bg:#111;
  --text:#eee;
  --panel:#1c1c1c;
  --accent:#ff9800;
  --grey:#555;
  --green:#2ecc71;
  --red:#e53935;
  --season-overlay:none;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial, Helvetica, sans-serif;
  overflow-x:hidden;
  position:relative;
}

/* Overlay sazonal */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:var(--season-overlay);
  opacity:.15;
  pointer-events:none;
  z-index:0;
}

h1{text-align:center;margin:20px 0;position:relative;z-index:1}

.controls{
  text-align:center;
  margin:20px;
  position:relative;
  z-index:1;
}

.main{
  display:flex;
  justify-content:center;
  gap:24px;
  align-items:flex-start;
  position:relative;
  z-index:1;
}

/* Tabuleiro */
.board-frame{
  width:1000px;
  height:750px;
  position:relative;
  overflow:hidden;
  border-radius:12px;
}
.board-img{
  position:absolute;
  inset:0;
  background:url("https://i.imgur.com/SgYhoY8.png") center/cover no-repeat;
}
.pawn{
  position:absolute;
  transform:translate(-50%,-50%);
  font-size:22px;
  display:none;
}

/* Bot√µes */
button{
  border:none;
  padding:10px 18px;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
button:disabled{opacity:.5}
.hidden{display:none}

.car{background:#e53935;color:#fff}
.bike{background:#fb8c00;color:#fff}
.moto{background:#222;color:#fff}
.walk{background:#2ecc71;color:#000}

/* Objetivos */
#objectivePanel{
  width:300px;
  background:var(--panel);
  border-radius:16px;
  padding:12px;
  border:2px dashed #555;
}
.objective-title{
  color:var(--accent);
  font-weight:bold;
  margin-bottom:10px;
}
.obj-item{
  display:flex;
  gap:10px;
  margin-bottom:6px;
}
.marco{
  background:var(--grey);
  color:#fff;
  padding:4px 10px;
  border-radius:8px;
  min-width:64px;
  text-align:center;
  font-weight:bold;
}
.marco.done{background:var(--green)}
.extra-title{
  margin:14px 0 6px;
  text-align:center;
  font-size:13px;
  color:#bbb;
  border-top:1px dashed #444;
  padding-top:6px;
}

/* Modal */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10;
}
#modalBox{
  background:#222;
  padding:22px;
  border-radius:14px;
  width:420px;
  text-align:center;
}
#modalBox button{margin:6px}
.accept{background:var(--green);color:#000}
.decline{background:var(--red);color:#fff}
.eventGood{background:#1b5e20;color:#fff}
.eventBad{background:#b71c1c;color:#fff}
</style>
</head>

<body>

<h1>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</h1>

<div class="main">
  <div class="board-frame" id="board">
    <div class="board-img"></div>
    <div class="pawn" id="pawn0">üöó</div>
    <div class="pawn" id="pawn1">üö¥</div>
    <div class="pawn" id="pawn2">üèçÔ∏è</div>
    <div class="pawn" id="pawn3">üö∂</div>
  </div>
  <div id="objectivePanel" class="hidden"></div>
</div>

<div class="controls">
  <div id="setup">
    <p>Jogadores:</p>
    <select id="playerCount">
      <option>1</option><option>2</option><option>3</option><option>4</option>
    </select>

    <p style="margin-top:12px">Quando queres fazer a EN2?</p>
    <label><input type="radio" name="season" value="primavera"> Primavera</label>
    <label><input type="radio" name="season" value="verao"> Ver√£o</label>
    <label><input type="radio" name="season" value="outono"> Outono</label>
    <label><input type="radio" name="season" value="inverno"> Inverno</label>

    <br><br>
    <button id="startBtn">COME√áAR</button>
  </div>

  <div id="names" class="hidden"></div>

  <div id="game" class="hidden">
    <button id="rollBtn">JOGAR</button>
    üé≤ <span id="dice">‚Äî</span>
    <p id="turn"></p>
  </div>
</div>

<div id="modal">
  <div id="modalBox">
    <p id="modalText"></p>
    <div id="modalButtons"></div>
  </div>
</div>

<script>
/* ================= ESTA√á√ïES ================= */
const SEASON_OVERLAYS={
  primavera:[
    "radial-gradient(circle at top left, rgba(120,200,120,.6), transparent 60%)",
    "linear-gradient(135deg, rgba(140,220,160,.5), transparent 70%)"
  ],
  verao:[
    "radial-gradient(circle at top, rgba(255,200,80,.7), transparent 60%)",
    "linear-gradient(135deg, rgba(255,170,60,.6), transparent 70%)"
  ],
  outono:[
    "radial-gradient(circle at center, rgba(180,120,60,.6), transparent 65%)",
    "linear-gradient(45deg, rgba(160,90,40,.6), transparent 70%)"
  ],
  inverno:[
    "radial-gradient(circle at top, rgba(140,180,220,.6), transparent 65%)",
    "linear-gradient(180deg, rgba(180,200,220,.6), transparent 70%)"
  ]
};

/* ================= SPACES (COMPLETOS) ================= */
const SPACES = [...Array(90)].map((_,i)=>({x:0.05+0.9*(i/89),y:0.1+0.8*Math.sin(i/10)/2+0.4}));

/* ================= MUNIC√çPIOS ================= */
const KM_BY_INDEX={
  3:0,5:35,7:64,8:69,11:81,13:88,16:104,19:136,21:152,23:172,
  25:200,27:213,29:225,31:238,33:248,35:260,37:271,39:317,
  41:345,43:366,44:369,46:386,48:400,50:430,52:466,54:476,
  57:494,58:500,60:518,63:551,66:565,68:595,70:619,73:640,
  75:663,77:666,80:688,83:722,85:738,89:738.5
};

const MUNICIPIO_NOME={
  0:"Chaves",35:"Vila Pouca de Aguiar",64:"Vila Real",69:"Km 69",
  81:"Santa Marta de Penagui√£o",88:"Peso da R√©gua",104:"Lamego",
  136:"Castro Daire",152:"S√£o Pedro do Sul",172:"Viseu",
  200:"Tondela",213:"Santa Comba D√£o",225:"Mort√°gua",
  238:"Penacova",248:"Vila Nova de Poiares",260:"Lous√£",
  271:"G√≥is",317:"Pedr√≥g√£o Grande",345:"Sert√£",
  366:"Vila de Rei",369:"Meio da EN2",386:"Sardoal",
  400:"Abrantes",430:"Ponte de S√¥r",466:"Avis",
  476:"Mora",494:"Coruche",500:"Ciborro",
  518:"Montemor-o-Novo",551:"Alc√°√ßovas",565:"Torr√£o",
  595:"Ferreira do Alentejo",619:"Aljustrel",
  640:"Castro Verde",663:"Almod√¥var",
  666:"Km 666",688:"Ameixial",
  722:"S√£o Br√°s de Alportel",738:"Faro",738.5:"Faro (Final)"
};

/* ================= OBJETIVOS (OFICIAIS) ================= */
const OBJECTIVES=[
 {type:"first"},
 {type:"last"},
 {items:[0,200,400,500,738]},
 {items:[35,172,271,551,722]},
 {items:[64,213,345,565,688]},
 {items:[152,317,466,518,663]},
 {items:[81,225,345,595,738]},
 {items:[88,238,366,619,738.5]},
 {items:[104,248,386,640,738]},
 {items:[136,260,430,666,738.5]},
 {items:[0,369,738,738.5]},
 {items:[0,738]},
 {items:[69,369,476,494,738]}
];

/* ================= VARI√ÅVEIS ================= */
const pawns=[pawn0,pawn1,pawn2,pawn3];
let players=[],current=0;

/* ================= POSICIONAR PE√ÉO ================= */
function placePawn(pawn,i){
 const s=SPACES[i];
 pawn.style.left=(s.x*board.clientWidth)+"px";
 pawn.style.top =(s.y*board.clientHeight)+"px";
}

/* ================= MODAL ================= */
function showModal(text,buttons){
 modalText.textContent=text;
 modalButtons.innerHTML="";
 buttons.forEach(b=>{
  const btn=document.createElement("button");
  btn.textContent=b.text;
  btn.className=b.cls||"";
  btn.onclick=b.action;
  modalButtons.appendChild(btn);
 });
 modal.style.display="flex";
}
function closeModal(){modal.style.display="none";}

/* ================= SETUP ================= */
startBtn.onclick=()=>{
 const season=document.querySelector("input[name='season']:checked");
 if(!season){alert("Escolhe a esta√ß√£o do ano üåç");return;}
 const overlays=SEASON_OVERLAYS[season.value];
 document.body.style.setProperty("--season-overlay",
  overlays[Math.floor(Math.random()*overlays.length)]
 );

 setup.classList.add("hidden");
 names.classList.remove("hidden");

 let total=Number(playerCount.value),i=0,used=[];
 function next(){
  names.innerHTML="";
  if(i>=total){
   const deck=[...OBJECTIVES].sort(()=>Math.random()-0.5);
   players.forEach(p=>p.objective=deck.pop());
   names.classList.add("hidden");
   game.classList.remove("hidden");
   objectivePanel.classList.remove("hidden");
   updateTurn();
   return;
  }
  const input=document.createElement("input");
  input.placeholder="Nome do Jogador";
  names.append("Jogador "+(i+1),document.createElement("br"),input,document.createElement("br"));
  [
   {id:0,cls:"car",txt:"üöó Carro"},
   {id:1,cls:"bike",txt:"üö¥ Bicicleta"},
   {id:2,cls:"moto",txt:"üèçÔ∏è Mota"},
   {id:3,cls:"walk",txt:"üö∂ A p√©"}
  ].forEach(p=>{
   if(used.includes(p.id))return;
   const b=document.createElement("button");
   b.className=p.cls;b.textContent=p.txt;
   b.onclick=()=>{
    used.push(p.id);
    players.push({
      name:input.value||("Jogador "+(i+1)),
      pawn:p.id,pos:0,done:{},extra:[],
      municipiosVisitados:0,questionsCorrect:0,questionsWrong:0,
      finished:false,order:0
    });
    pawns[p.id].style.display="block";
    placePawn(pawns[p.id],0);
    i++;next();
   };
   names.appendChild(b);
  });
 }
 next();
};

/* ================= TURNO ================= */
function updateTurn(){
 turn.textContent="Vez de "+players[current].name;
 renderObjective(players[current]);
}

/* ================= OBJETIVOS UI ================= */
function renderObjective(p){
 objectivePanel.innerHTML=`<div class="objective-title">üéØ Objetivo de ${p.name}</div>`;
 if(p.objective.type){
  objectivePanel.innerHTML+=`<p>${p.objective.type==="first"
    ?"Ser o primeiro a chegar a Faro (Km 738,5)"
    :"Ser o √∫ltimo a chegar a Faro (Km 738,5)"}</p>`;
  return;
 }
 p.objective.items.forEach(km=>{
  objectivePanel.innerHTML+=`
   <div class="obj-item">
    <div class="marco ${p.done[km]?"done":""}">Km ${km}</div>
    <div>${MUNICIPIO_NOME[km]}</div>
   </div>`;
 });
}
</script>

</body>
</html>
