<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</title>

<style>
:root{
  --bg:#111;
  --accent:#f5c400;
  --text:#fff;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,Helvetica,sans-serif;
}
h1{text-align:center;margin:20px 0;}

.game-layout{
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:24px;
}

/* TABULEIRO */
.board-frame{
  width:1000px;
  height:750px;
  position:relative;
  overflow:hidden;
  border-radius:10px;
}
.board-img{
  position:absolute;
  inset:0;
  background:url("https://i.imgur.com/SgYhoY8.png") center/cover no-repeat;
}
.zoom{position:absolute;inset:0}

/* PE√ïES */
.pawn{
  position:absolute;
  transform:translate(-50%,-50%);
  font-size:22px;
  pointer-events:none;
}

/* CONTROLOS */
.controls{text-align:center;margin:20px 0}
button{
  background:var(--accent);
  border:none;
  padding:10px 18px;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
.hidden{display:none}

/* BOT√ïES PE√ïES */
.pawn-btn{
  border:none;
  padding:10px 16px;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
  margin:6px;
  font-size:15px;
  color:#fff;
}
.pawn-btn.car{background:#d62828;}
.pawn-btn.bike{background:#f5c400;color:#111;}
.pawn-btn.motor{background:#000;}
.pawn-btn.walk{background:#2ecc71;}

/* CARTA OBJETIVO */
#objectivePanel{width:320px}
.objective-card{
  background:linear-gradient(145deg,#2a2a2a,#1b1b1b);
  border:2px dashed #666;
  border-radius:18px;
  padding:16px;
}
.objective-marcos{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:14px;
}

.objective-marco{
  width:56px;
  height:56px;
  border-radius:50%;
  background:#555;
  color:#111;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:13px;
  border:2px solid #777;
}

.objective-marco.done{
  background:#f5c400;
  border-color:#f5c400;
  color:#111;
}

.objective-header{
  color:#f5c400;
  font-weight:bold;
  margin-bottom:10px;
}
.objective-marks{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-top:14px;
}
.objective-marco{
  width:56px;
  height:64px;
  border-radius:10px;
  background:#666;
  color:#111;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:14px;
}
.objective-marco.done{
  background:#f5c400;
  color:#111;
}
</style>
</head>

<body>

<h1>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</h1>

<div class="game-layout">

  <div class="board-frame" id="boardFrame">
    <div class="zoom">
      <div class="board-img"></div>
      <div class="pawn" id="pawn0">üöó</div>
      <div class="pawn" id="pawn1">üö¥</div>
      <div class="pawn" id="pawn2">üèçÔ∏è</div>
      <div class="pawn" id="pawn3">üö∂</div>
    </div>
  </div>

  <div id="objectivePanel" class="hidden"></div>
</div>

<div class="controls">
  <div id="setupPlayers">
    Jogadores:
    <select id="playerCount">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
    <button id="startBtn">COME√áAR</button>
  </div>

  <div id="pawnSelect" class="hidden">
    <p id="pawnQuestion"></p>
    <div id="pawnButtons"></div>
  </div>

  <div id="gameControls" class="hidden">
    <button id="rollBtn">JOGAR</button>
    üé≤ <span id="diceVal">‚Äî</span>
    <p id="turnInfo"></p>
  </div>
</div>

<script>
// ================= SPACES (simplificado p/ teste) =================
const SPACES = Array.from({length:100},(_,i)=>({
  x:0.1 + (i%10)*0.08,
  y:0.1 + Math.floor(i/10)*0.07
}));

// ================= OBJETIVOS (√öNICOS) =================
const OBJECTIVES = [
  {
    kms: [
      { value: 81, label: "Santa Marta de Penagui√£o", index: 10, done:false },
      { value: 225, label: "Mort√°gua", index: 30, done:false },
      { value: 345, label: "Sert√£", index: 45, done:false },
      { value: 595, label: "Ferreira do Alentejo", index: 78, done:false },
      { value: 738, label: "Faro", index: 95, done:false }
    ]
  }
];

// ================= ELEMENTOS =================
const board=document.getElementById("boardFrame");
const pawns=[pawn0,pawn1,pawn2,pawn3];
const startBtn=document.getElementById("startBtn");
const pawnSelect=document.getElementById("pawnSelect");
const pawnButtons=document.getElementById("pawnButtons");
const pawnQuestion=document.getElementById("pawnQuestion");
const setupPlayers=document.getElementById("setupPlayers");
const gameControls=document.getElementById("gameControls");
const rollBtn=document.getElementById("rollBtn");
const diceVal=document.getElementById("diceVal");
const turnInfo=document.getElementById("turnInfo");
const objectivePanel=document.getElementById("objectivePanel");
const playerCount=document.getElementById("playerCount");

const pawnTypes=[
{id:0,label:"üöó Carro",cls:"car"},
{id:1,label:"üö¥ Bicicleta",cls:"bike"},
{id:2,label:"üèçÔ∏è Mota",cls:"motor"},
{id:3,label:"üö∂ A p√©",cls:"walk"}
];

let players=[];
let positions=[0,0,0,0];
let currentPlayer=0;

// ================= FUN√á√ïES =================
function placePawn(pawn,i){
  const s=SPACES[i];
  pawn.style.left=(s.x*board.clientWidth)+"px";
  pawn.style.top =(s.y*board.clientHeight)+"px";
}

// ================= SETUP =================
startBtn.onclick=()=>{
  players=[];
  setupPlayers.classList.add("hidden");
  pawnSelect.classList.remove("hidden");
  pawnQuestion.textContent="Jogador 1, como quer viajar?";
  renderPawnButtons(Number(playerCount.value));
};

function renderPawnButtons(max){
  pawnButtons.innerHTML="";
  pawnTypes.forEach(p=>{
    if(players.find(pl=>pl.pawn===p.id))return;
    const b=document.createElement("button");
    b.textContent=p.label;
    b.className="pawn-btn "+p.cls;
    b.onclick=()=>{
      players.push({pawn:p.id,objective:null,done:[]});
      if(players.length===max) startGame();
      else{
        pawnQuestion.textContent=`Jogador ${players.length+1}, como quer viajar?`;
        renderPawnButtons(max);
      }
    };
    pawnButtons.appendChild(b);
  });
}

// ================= IN√çCIO =================
function startGame(){
  pawnSelect.classList.add("hidden");
  gameControls.classList.remove("hidden");
  objectivePanel.classList.remove("hidden");

  currentPlayer=0;
  positions=[0,0,0,0];
  pawns.forEach(p=>p.style.display="none");

  players.forEach(p=>{
    pawns[p.pawn].style.display="block";
    placePawn(pawns[p.pawn],0);
  });

  const deck=[...OBJECTIVES].sort(()=>Math.random()-0.5);
  players.forEach(p=>p.objective=deck.pop());

  updateTurn();
}

function updateTurn(){
  const player=players[currentPlayer];
  turnInfo.textContent=`Vez do Jogador ${currentPlayer+1}`;

  function renderObjectiveCard(player, playerIndex) {
  const marcosHTML = player.objective.kms.map(km => `
    <div class="objective-marco ${km.done ? 'done' : ''}" id="marco-${km.value}">
      Km ${km.value}
    </div>
  `).join("");

  const textoHTML = player.objective.kms.map(km => `
    ‚Ä¢ ${km.label} (Km ${km.value})
  `).join("<br>");

  objectivePanel.innerHTML = `
    <div class="objective-card">
      <div class="objective-header">
        üß≠ Objetivo do Jogador ${playerIndex + 1}
      </div>

      <div class="objective-marcos">
        ${marcosHTML}
      </div>

      <div class="objective-body">
        Tens como objetivo visitar:<br><br>
        ${textoHTML}
      </div>
    </div>
  `;
}

// ================= JOGAR =================
rollBtn.onclick = async () => {
  const r = Math.floor(Math.random() * 6) + 1;
  diceVal.textContent = r;

  const pawnId = players[currentPlayer].pawn;

  for (let i = 0; i < r; i++) {
    positions[pawnId] = Math.min(SPACES.length - 1, positions[pawnId] + 1);
    placePawn(pawns[pawnId], positions[pawnId]);
    await new Promise(res => setTimeout(res, 300));
  }

  // üî• AQUI ‚Äî N√ÉO √â FORA, N√ÉO √â ABAIXO
  const player = players[currentPlayer];

  if (player.objective.kms) {
    player.objective.kms.forEach(km => {
      if (positions[pawnId] === km.index && !km.done) {
        const acertou = confirm(
          `Pergunta do munic√≠pio ${km.label} (Km ${km.value})\n\nResposta certa?`
        );

        if (acertou) {
          km.done = true;
          const el = document.getElementById("marco-" + km.value);
          if (el) el.classList.add("done");
        }
      }
    });
  }

  currentPlayer = (currentPlayer + 1) % players.length;
  updateTurn();
};

</script>
</body>
</html>
