<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</title>

<style>
:root{
  --bg:#111;--text:#eee;--panel:#1c1c1c;
  --accent:#ff9800;--grey:#555;--green:#2ecc71;--red:#e53935;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:Arial}
h1{text-align:center;margin:20px 0}
.main{display:flex;justify-content:center;gap:24px;align-items:flex-start}

.board-frame{width:1000px;height:750px;position:relative;overflow:hidden;border-radius:10px}
.board-img{position:absolute;inset:0;background:url("https://i.imgur.com/SgYhoY8.png") center/cover no-repeat}
.pawn{position:absolute;transform:translate(-50%,-50%);font-size:22px;pointer-events:none;display:none}

.controls{text-align:center;margin:20px}
button{border:none;padding:10px 18px;border-radius:10px;font-weight:bold;cursor:pointer}
button:disabled{opacity:.5}
.hidden{display:none}

.car{background:#e53935;color:#fff}
.bike{background:#fb8c00;color:#fff}
.moto{background:#222;color:#fff}
.walk{background:#2ecc71;color:#000}

#objectivePanel{
  width:300px;background:var(--panel);
  border-radius:16px;padding:12px;
  border:2px dashed #555;
}
.objective-title{color:var(--accent);font-weight:bold;margin-bottom:10px}
.obj-item{display:flex;gap:10px;margin-bottom:6px}
.marco{
  background:var(--grey);color:#fff;
  padding:4px 10px;border-radius:8px;
  min-width:64px;text-align:center;font-weight:bold
}
.marco.done{background:var(--green)}

#modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  display:none;align-items:center;justify-content:center
}
#modalBox{
  background:#222;padding:22px;
  border-radius:14px;width:420px;text-align:center
}
#modalBox button{margin:6px}
.accept{background:var(--green);color:#000}
.decline{background:var(--red);color:#fff}
.eventGood{background:#1b5e20;color:#fff}
.eventBad{background:#b71c1c;color:#fff}
</style>
</head>

<body>

<h1>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</h1>

<div class="main">
  <div class="board-frame" id="board">
    <div class="board-img"></div>
    <div class="pawn" id="pawn0">üöó</div>
    <div class="pawn" id="pawn1">üö¥</div>
    <div class="pawn" id="pawn2">üèçÔ∏è</div>
    <div class="pawn" id="pawn3">üö∂</div>
  </div>
  <div id="objectivePanel" class="hidden"></div>
</div>

<div class="controls">
  <div id="setup">
    Jogadores:
    <select id="playerCount">
      <option>1</option><option>2</option><option>3</option><option>4</option>
    </select>
    <button id="startBtn">COME√áAR</button>
  </div>
  <div id="names" class="hidden"></div>
  <div id="game" class="hidden">
    <button id="rollBtn">JOGAR</button>
    üé≤ <span id="dice">‚Äî</span>
    <p id="turn"></p>
  </div>
</div>

<div id="modal">
  <div id="modalBox">
    <p id="modalText"></p>
    <div id="modalButtons"></div>
  </div>
</div>

<script>
/* ===== SPACES ===== */
const SPACES = [...Array(90)].map((_,i)=>({x:0.1+i*0.008,y:0.12+i*0.008}));

/* ===== MUNIC√çPIOS ===== */
const MUNICIPIO_NOME={
0:"Chaves",
35:"Vila Pouca de Aguiar",
64:"Vila Real",
69:"Km 69",
81:"Santa Marta de Penagui√£o",
88:"Peso da R√©gua",
104:"Lamego",
136:"Castro Daire",
152:"Mort√°gua",
172:"Viseu",
200:"Tondela",
213:"Santa Comba D√£o",
225:"Mort√°gua",
238:"Penacova",
248:"Vila Nova de Poiares",
260:"Lous√£",
271:"G√≥is",
324:"Sert√£",
345:"Sert√£",
366:"Vila de Rei",
369:"Meio da Estrada",
386:"Sardoal",
400:"Abrantes",
430:"Ponte de S√¥r",
466:"Avis",
476:"Mora",
494:"Coruche",
500:"Ciborro",
518:"Montemor-o-Novo",
551:"Alc√°√ßovas",
565:"Torr√£o",
595:"Ferreira do Alentejo",
619:"Aljustrel",
640:"Castro Verde",
663:"Almod√¥var",
666:"Km 666",
688:"Ameixial",
722:"S√£o Br√°s de Alportel",
738:"Faro",
738.5:"Faro (Final)"
};

/* ===== KM POR CASA ===== */
const KM_BY_INDEX={
3:0,5:35,7:64,8:69,11:81,13:88,16:104,19:136,
21:152,23:172,25:200,27:213,29:225,31:238,33:248,
35:260,37:271,39:324,41:345,43:366,44:369,46:386,
48:400,50:430,52:466,54:476,57:494,58:500,60:518,
63:551,66:565,68:595,70:619,73:640,75:663,77:666,
80:688,83:722,85:738,89:738.5
};

const SPECIAL_CELLS={};
Object.keys(KM_BY_INDEX).forEach(i=>{
  SPECIAL_CELLS[i]={km:KM_BY_INDEX[i],final:i==89};
});

/* ===== EVENTOS ===== */
const EVENTS=[
 {text:"Bons momentos! Avan√ßa +1 casa.",move:1,cls:"eventGood"},
 {text:"Contratempo! Recua 1 casa.",move:-1,cls:"eventBad"}
];

/* ===== PERGUNTAS ===== */
const QUESTIONS=[
 "Qual √© o rio mais longo de Portugal?",
 "Qual √© a capital do Algarve?"
];

/* ===== OBJETIVOS ===== */
const OBJECTIVES=[
 {items:[{km:0,text:"Chaves"},{km:400,text:"Abrantes"},{km:738.5,text:"Faro"}]},
 {items:[{km:69,text:"Km 69"},{km:369,text:"Meio da Estrada"},{km:738.5,text:"Faro"}]}
];

const pawns=[pawn0,pawn1,pawn2,pawn3];
let players=[],current=0;

/* ===== FUN√á√ïES ===== */
function placePawn(pawn,i){
 const s=SPACES[i];
 pawn.style.left=(s.x*board.clientWidth)+"px";
 pawn.style.top =(s.y*board.clientHeight)+"px";
}

function showModal(text,buttons){
 modalText.textContent=text;
 modalButtons.innerHTML="";
 buttons.forEach(b=>{
  const btn=document.createElement("button");
  btn.textContent=b.text;
  btn.className=b.cls||"";
  btn.onclick=b.action;
  modalButtons.appendChild(btn);
 });
 modal.style.display="flex";
}
function closeModal(){modal.style.display="none";}

/* ===== SETUP ===== */
startBtn.onclick=()=>{
 setup.classList.add("hidden");
 names.classList.remove("hidden");
 let total=playerCount.value,i=0;
 function next(){
  names.innerHTML="";
  if(i>=total){
   const deck=[...OBJECTIVES];
   players.forEach(p=>p.objective=deck[i%deck.length]);
   names.classList.add("hidden");
   game.classList.remove("hidden");
   objectivePanel.classList.remove("hidden");
   updateTurn();
   return;
  }
  const input=document.createElement("input");
  input.placeholder="Nome";
  names.append(input,document.createElement("br"));
  const b=document.createElement("button");
  b.textContent="üöó";
  b.onclick=()=>{
   players.push({name:input.value||"Jogador",pawn:i,pos:0,done:{},finished:false});
   pawns[i].style.display="block";
   placePawn(pawns[i],0);
   i++;next();
  };
  names.appendChild(b);
 }
 next();
};

function updateTurn(){
 if(players.every(p=>p.finished)) return;
 turn.textContent="Vez de "+players[current].name;
 renderObjective(players[current]);
}

function renderObjective(p){
 objectivePanel.innerHTML=`<div class="objective-title">üéØ Objetivo</div>`;
 p.objective.items.forEach(it=>{
  objectivePanel.innerHTML+=`
   <div class="obj-item">
    <div class="marco ${p.done[it.km]?"done":""}">Km ${it.km}</div>
    <div>${it.text}</div>
   </div>`;
 });
}

rollBtn.onclick=async()=>{
 rollBtn.disabled=true;
 const r=Math.floor(Math.random()*6)+1;
 dice.textContent=r;
 const p=players[current];
 let target=Math.min(p.pos+r,SPACES.length-1);
 while(p.pos!==target){
  p.pos++;
  placePawn(pawns[p.pawn],p.pos);
  await new Promise(r=>setTimeout(r,300));
 }
 const cell=SPECIAL_CELLS[p.pos];
 if(cell){
  showModal("Chegaste a "+MUNICIPIO_NOME[cell.km],[{
   text:"OK",cls:"accept",action:()=>{
    closeModal();
    if(cell.final) p.finished=true;
    current=(current+1)%players.length;
    updateTurn();
   }
  }]);
 }else{
  current=(current+1)%players.length;
  updateTurn();
 }
 rollBtn.disabled=false;
};
</script>

</body>
</html>
