<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Jogo da EN2 ‚Äî A Grande Travessia de Portugal</title>

<style>
:root{
  --bg:#111;
  --accent:#f5c400;
  --text:#fff;
  --inactive:#777;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,Helvetica,sans-serif;
}
.wrap{
  max-width:1400px;
  margin:20px auto;
}
h1{text-align:center}

.main{
  display:flex;
  gap:20px;
  align-items:flex-start;
}

/* TABULEIRO */
.board-frame{
  flex:0 0 1000px;
  aspect-ratio:4/3;
  position:relative;
  overflow:hidden;
  border-radius:6px;
  box-shadow:0 8px 30px rgba(0,0,0,.6);
}
.zoom{
  position:absolute;
  inset:0;
  transition:transform .35s ease;
}
.board-img{
  position:absolute;
  inset:0;
  background:url("https://i.imgur.com/SgYhoY8.png") center/cover no-repeat;
}

/* PE√ïES */
.pawn{
  position:absolute;
  width:22px;
  height:22px;
  border-radius:50%;
  transform:translate(-50%,-50%);
  font-size:12px;
  display:none;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 12px rgba(0,0,0,.5);
}
.car{background:#f5c400;color:#111}
.bike{background:#4bb39a}
.motor{background:#ef4a8a}
.person{background:#4267ff}

/* CONTROLOS */
.controls{
  margin:15px 0;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
}
.btn{
  padding:10px 18px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  background:var(--accent);
  cursor:pointer;
}
.help{color:#ccc;font-size:14px;text-align:center}

/* ESCOLHA PE√ïES */
#pawnChoice{
  text-align:center;
  margin:15px 0;
}
#pawnButtons{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}

/* OBJETIVO */
.objective-panel{
  flex:1;
  background:#1a1a1a;
  border-radius:8px;
  padding:14px;
}
.objective-panel h3{margin-top:0}

.milestone{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:6px;
  color:var(--inactive);
}
.milestone svg{
  width:20px;
  height:28px;
  fill:currentColor;
}
.progress{
  margin-top:10px;
  font-size:14px;
  color:#ddd;
}
</style>
</head>

<body>
<div class="wrap">

<h1>JOGO DA EN2 ‚Äî A Grande Travessia de Portugal</h1>

<!-- CONTROLOS INICIAIS -->
<div class="controls">
  <span id="playersLabel">Jogadores:</span>
  <select id="playerCount">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4" selected>4</option>
  </select>
  <button class="btn" id="startBtn">COME√áAR</button>
  <button class="btn" id="rollBtn" style="display:none">JOGAR</button>
  üé≤ <strong id="diceVal">‚Äî</strong>
  <span id="turnInfo"></span>
</div>

<!-- ESCOLHA DE PE√ïES -->
<div id="pawnChoice" style="display:none">
  <p id="pawnQuestion"></p>
  <div id="pawnButtons"></div>
</div>

<div class="main">
  <!-- TABULEIRO -->
  <div class="board-frame" id="boardFrame">
    <div class="zoom" id="zoomWrap">
      <div class="board-img"></div>
      <div class="pawn car" id="pawn0">üöó</div>
      <div class="pawn bike" id="pawn1">üö¥</div>
      <div class="pawn motor" id="pawn2">üèçÔ∏è</div>
      <div class="pawn person" id="pawn3">üö∂</div>
    </div>
  </div>

  <!-- OBJETIVO -->
  <div class="objective-panel">
    <h3>Objetivo</h3>
    <div id="objectiveContent">‚Äî</div>
  </div>
</div>

<div class="help">
  Carta de objetivo vis√≠vel apenas para o jogador da vez.
</div>

</div>

<script>
// ===============================
// SPACES (usa a tua lista completa)
// ===============================
const SPACES = [
  {"x":0.0916530278,"y":0.1137939783},
  {"x":0.0867430441,"y":0.1625084573},
  {"x":0.0867430441,"y":0.2152824763},
  {"x":0.0916530278,"y":0.2700862652}
  // mant√©m aqui a tua lista completa
];

// ===============================
// OBJETIVOS (exemplo base)
// ===============================
const OBJECTIVES = [
  {
    text:"O teu objectivo √© ser o primeiro a chegar a Faro (Km 738,5)",
    items:[{label:"Faro",km:"738,5"}]
  },
  {
    text:"Quem disse que o √∫ltimo n√£o pode ganhar? O teu objectivo √© ser o √∫ltimo a chegar a Faro (Km 738,5)",
    items:[{label:"Faro",km:"738,5"}]
  },
  {
    text:"Tens como objectivo visitar:",
    items:[
      {label:"Chaves",km:"0"},
      {label:"Tondela",km:"200"},
      {label:"Abrantes",km:"400"},
      {label:"Ciborro",km:"500"},
      {label:"Faro",km:"738"}
    ]
  }
];

// ===============================
// ELEMENTOS
// ===============================
const boardFrame = document.getElementById("boardFrame");
const pawns = [
  document.getElementById("pawn0"),
  document.getElementById("pawn1"),
  document.getElementById("pawn2"),
  document.getElementById("pawn3")
];
const startBtn = document.getElementById("startBtn");
const rollBtn  = document.getElementById("rollBtn");
const diceVal  = document.getElementById("diceVal");
const turnInfo = document.getElementById("turnInfo");
const playerSel = document.getElementById("playerCount");
const playersLabel = document.getElementById("playersLabel");

const pawnChoice = document.getElementById("pawnChoice");
const pawnQuestion = document.getElementById("pawnQuestion");
const pawnButtons = document.getElementById("pawnButtons");
const objectiveContent = document.getElementById("objectiveContent");

// ===============================
// ESTADO
// ===============================
let totalPlayers = 0;
let players = [];
let currentPlayer = 0;
let usedPawns = [];

// ===============================
// FUN√á√ïES BASE
// ===============================
function placePawn(pawn,i){
  pawn.style.left = SPACES[i].x * boardFrame.clientWidth+"px";
  pawn.style.top  = SPACES[i].y * boardFrame.clientHeight+"px";
}
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

// ===============================
// ESCOLHA DE PE√ïES
// ===============================
function showPawnChoice(){
  pawnChoice.style.display = "block";
  pawnButtons.innerHTML = "";
  pawnQuestion.textContent =
    `Jogador ${players.length+1}, como quer viajar?`;

  const icons = ["üöó","üö¥","üèçÔ∏è","üö∂"];

  icons.forEach((icon,i)=>{
    if(usedPawns.includes(i)) return;

    const b = document.createElement("button");
    b.className = "btn";
    b.textContent = icon;

    b.onclick = ()=>{
      usedPawns.push(i);
      players.push({
        pawn:i,
        pos:0,
        objective:null
      });
      pawns[i].style.display="flex";
      placePawn(pawns[i],0);

      if(players.length < totalPlayers){
        showPawnChoice();
      }else{
        pawnChoice.style.display="none";
        assignObjectives();
      }
    };
    pawnButtons.appendChild(b);
  });
}

// ===============================
// OBJETIVOS
// ===============================
function assignObjectives(){
  const deck = shuffle([...OBJECTIVES]);
  players.forEach(p=>p.objective = deck.pop());
  rollBtn.style.display="inline-block";
  turnInfo.textContent = "Vez do Jogador 1";
  renderObjective();
}

function renderObjective(){
  const obj = players[currentPlayer].objective;
  let html = `<p><strong>${obj.text}</strong></p>`;
  obj.items.forEach(it=>{
    html += `
      <div class="milestone">
        <svg viewBox="0 0 24 32">
          <path d="M6 2h12v24l-6 4-6-4z"/>
        </svg>
        ${it.label} ‚Äî Km ${it.km}
      </div>`;
  });
  html += `<div class="progress">Progresso: 0 / ${obj.items.length}</div>`;
  objectiveContent.innerHTML = html;
}

// ===============================
// SETUP
// ===============================
startBtn.onclick = ()=>{
  totalPlayers = Number(playerSel.value);
  players = [];
  usedPawns = [];
  currentPlayer = 0;

  playersLabel.style.display="none";
  playerSel.style.display="none";
  startBtn.style.display="none";

  pawns.forEach(p=>p.style.display="none");

  showPawnChoice();
};

// ===============================
// DADO
// ===============================
rollBtn.onclick = async ()=>{
  const r = Math.floor(Math.random()*6)+1;
  diceVal.textContent = r;

  for(let i=0;i<r;i++){
    players[currentPlayer].pos =
      Math.min(players[currentPlayer].pos+1, SPACES.length-1);
    placePawn(
      pawns[players[currentPlayer].pawn],
      players[currentPlayer].pos
    );
    await new Promise(res=>setTimeout(res,400));
  }

  currentPlayer = (currentPlayer+1)%players.length;
  turnInfo.textContent = "Vez do Jogador "+(currentPlayer+1);
  renderObjective();
};
</script>

</body>
</html>
